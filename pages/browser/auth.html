<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端认证技术 | 不断进步</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vue-press-docs/不断进步.JPG">
    <meta name="description" content="Hit的前端笔记">
    
    <link rel="preload" href="/vue-press-docs/assets/css/0.styles.8e0a4dbf.css" as="style"><link rel="preload" href="/vue-press-docs/assets/js/app.d8725ef0.js" as="script"><link rel="preload" href="/vue-press-docs/assets/js/2.a05206b7.js" as="script"><link rel="preload" href="/vue-press-docs/assets/js/13.c5264567.js" as="script"><link rel="prefetch" href="/vue-press-docs/assets/js/10.291c5b1d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/11.837906d7.js"><link rel="prefetch" href="/vue-press-docs/assets/js/12.68839ecd.js"><link rel="prefetch" href="/vue-press-docs/assets/js/14.29739af6.js"><link rel="prefetch" href="/vue-press-docs/assets/js/15.e3c8b020.js"><link rel="prefetch" href="/vue-press-docs/assets/js/16.218006ef.js"><link rel="prefetch" href="/vue-press-docs/assets/js/17.e118f6a2.js"><link rel="prefetch" href="/vue-press-docs/assets/js/18.a6aa10bb.js"><link rel="prefetch" href="/vue-press-docs/assets/js/19.8a65c4ea.js"><link rel="prefetch" href="/vue-press-docs/assets/js/20.2a59e164.js"><link rel="prefetch" href="/vue-press-docs/assets/js/21.f3d67e95.js"><link rel="prefetch" href="/vue-press-docs/assets/js/22.0f5ad16d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/23.21d9d0f1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/24.3d484fb5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/25.c603a96a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/26.9ab9b754.js"><link rel="prefetch" href="/vue-press-docs/assets/js/27.38a22fef.js"><link rel="prefetch" href="/vue-press-docs/assets/js/28.a6fb0ad4.js"><link rel="prefetch" href="/vue-press-docs/assets/js/29.6b6978f8.js"><link rel="prefetch" href="/vue-press-docs/assets/js/3.a38e7322.js"><link rel="prefetch" href="/vue-press-docs/assets/js/30.9105745c.js"><link rel="prefetch" href="/vue-press-docs/assets/js/31.646dcbc3.js"><link rel="prefetch" href="/vue-press-docs/assets/js/32.6fb88f54.js"><link rel="prefetch" href="/vue-press-docs/assets/js/33.efb42491.js"><link rel="prefetch" href="/vue-press-docs/assets/js/34.53339129.js"><link rel="prefetch" href="/vue-press-docs/assets/js/35.368c2a62.js"><link rel="prefetch" href="/vue-press-docs/assets/js/36.593a1558.js"><link rel="prefetch" href="/vue-press-docs/assets/js/37.03b7eb3f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/38.119c7171.js"><link rel="prefetch" href="/vue-press-docs/assets/js/39.f3303696.js"><link rel="prefetch" href="/vue-press-docs/assets/js/4.0911b1c1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/40.a727a31c.js"><link rel="prefetch" href="/vue-press-docs/assets/js/41.df01778a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/42.24907559.js"><link rel="prefetch" href="/vue-press-docs/assets/js/43.f7efdd24.js"><link rel="prefetch" href="/vue-press-docs/assets/js/44.ed8a586a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/45.4153c8f6.js"><link rel="prefetch" href="/vue-press-docs/assets/js/46.38ee2887.js"><link rel="prefetch" href="/vue-press-docs/assets/js/47.fafe4e22.js"><link rel="prefetch" href="/vue-press-docs/assets/js/48.11cf3a32.js"><link rel="prefetch" href="/vue-press-docs/assets/js/49.9b4b506b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/5.30bb248a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/50.90535ee5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/51.59a46172.js"><link rel="prefetch" href="/vue-press-docs/assets/js/52.34a795d5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/53.b82f43b1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/54.9a76148f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/55.75ac5779.js"><link rel="prefetch" href="/vue-press-docs/assets/js/56.afdafb93.js"><link rel="prefetch" href="/vue-press-docs/assets/js/57.769f07f9.js"><link rel="prefetch" href="/vue-press-docs/assets/js/58.91bd0e5b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/59.9b1b7a2b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/6.262368dc.js"><link rel="prefetch" href="/vue-press-docs/assets/js/60.79f7ba50.js"><link rel="prefetch" href="/vue-press-docs/assets/js/61.e2b3466d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/62.25ae7055.js"><link rel="prefetch" href="/vue-press-docs/assets/js/63.1c398391.js"><link rel="prefetch" href="/vue-press-docs/assets/js/64.8fa35e00.js"><link rel="prefetch" href="/vue-press-docs/assets/js/65.6c8bf068.js"><link rel="prefetch" href="/vue-press-docs/assets/js/66.44daef8f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/67.66f09b37.js"><link rel="prefetch" href="/vue-press-docs/assets/js/68.6ffa134a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/69.d547c1ee.js"><link rel="prefetch" href="/vue-press-docs/assets/js/7.fd046e46.js"><link rel="prefetch" href="/vue-press-docs/assets/js/70.c933e292.js"><link rel="prefetch" href="/vue-press-docs/assets/js/71.4170c744.js"><link rel="prefetch" href="/vue-press-docs/assets/js/72.759f4574.js"><link rel="prefetch" href="/vue-press-docs/assets/js/73.60ef846f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/74.bcd5ecfd.js"><link rel="prefetch" href="/vue-press-docs/assets/js/75.20843078.js"><link rel="prefetch" href="/vue-press-docs/assets/js/76.fc952e66.js"><link rel="prefetch" href="/vue-press-docs/assets/js/77.7dd7f97f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/78.2650c24b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/79.b8caa6ba.js"><link rel="prefetch" href="/vue-press-docs/assets/js/8.a8d31d14.js"><link rel="prefetch" href="/vue-press-docs/assets/js/80.4a4a3d20.js"><link rel="prefetch" href="/vue-press-docs/assets/js/81.86cec7de.js"><link rel="prefetch" href="/vue-press-docs/assets/js/9.179dc13a.js">
    <link rel="stylesheet" href="/vue-press-docs/assets/css/0.styles.8e0a4dbf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-press-docs/" class="home-link router-link-active"><img src="/vue-press-docs/hit.JPG" alt="不断进步" class="logo"> <span class="site-name can-hide">不断进步</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-press-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/html/html.html" class="nav-link">
  html系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/css/css.html" class="nav-link">
  css系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/javaScript/Object.freeze()和const.html" class="nav-link">
  javaScript系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/typeScript/base.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/http/http.html" class="nav-link">
  http系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/project/guide.html" class="nav-link">
  前端工程化系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/node/node.html" class="nav-link">
  node系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/browser/browser.html" class="nav-link">
  浏览器系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework/nextTick.html" class="nav-link">
  框架使用系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework-source/vue-source.html" class="nav-link">
  框架源码系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/optimization/vue-code.html" class="nav-link">
  性能优化系列
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Huhui-coder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-press-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/html/html.html" class="nav-link">
  html系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/css/css.html" class="nav-link">
  css系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/javaScript/Object.freeze()和const.html" class="nav-link">
  javaScript系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/typeScript/base.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/http/http.html" class="nav-link">
  http系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/project/guide.html" class="nav-link">
  前端工程化系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/node/node.html" class="nav-link">
  node系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/browser/browser.html" class="nav-link">
  浏览器系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework/nextTick.html" class="nav-link">
  框架使用系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework-source/vue-source.html" class="nav-link">
  框架源码系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/optimization/vue-code.html" class="nav-link">
  性能优化系列
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Huhui-coder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-press-docs/pages/browser/browser.html" class="sidebar-link">前端攻击技术</a></li><li><a href="/vue-press-docs/pages/browser/storage.html" class="sidebar-link">前端存储技术</a></li><li><a href="/vue-press-docs/pages/browser/auth.html" aria-current="page" class="active sidebar-link">前端认证技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#认证技术" class="sidebar-link">认证技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#http-basic-authentication" class="sidebar-link">HTTP Basic Authentication</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#sesion-cookie" class="sidebar-link">Sesion-Cookie</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#token-验证" class="sidebar-link">Token 验证</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#oauth-2-0-开放授权" class="sidebar-link">OAuth 2.0(开放授权)</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/browser/auth.html#实践" class="sidebar-link">实践</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端认证技术"><a href="#前端认证技术" class="header-anchor">#</a> 前端认证技术</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>总所周知，<code>http</code> 本身是一种无状态的协议，那么 <code>http</code> 是如何进行用户身份认证并且记住用户的状态的?</p> <p>举个栗子:用户登录之后，就不会再跳转至登录页了，而是跳转到正常的业务页面。</p> <p>要想实现上述的场景需求，首先我们需要理解什么是 认证(Authentication)。</p> <blockquote><p>服务器端通过一系列手段(收集到用户的账号和密码等)进行用户身份认证，认证通过后让其无障碍的访问服务器端的资源。</p></blockquote> <p>常规认证流程如下：</p> <p>当用户输入用户名，密码之后 ==&gt; 发送到服务器端验证 ==&gt; 验证通过 ==&gt; 返回 Token(授权标识) ==&gt; 前端存储 Token ==&gt; 下次请求将其带上，即可实现认证流程。</p> <p>关于前端存储这一块儿，可以借助前端的存储技术,比如: <code>localStorage</code>, <code>Cookies</code>, <code>Sesion</code>。</p> <p>对于前端存储技术的介绍可以前往: <a href="https://huhui-coder.github.io/vue-press-docs/pages/browser/storage.html" target="_blank" rel="noopener noreferrer">前端存储技术<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="认证技术"><a href="#认证技术" class="header-anchor">#</a> 认证技术</h2> <p>接下来详细讲讲四种不同方式的认证手段。</p> <ol><li>HTTP Basic Authentication</li> <li>Sesion-Cookie</li> <li>Token 验证</li> <li>OAuth(开放授权)</li></ol> <h3 id="http-basic-authentication"><a href="#http-basic-authentication" class="header-anchor">#</a> HTTP Basic Authentication</h3> <p>这种授权方式是浏览器遵守 <code>http</code> 协议实现的基本授权方式, <code>http</code> 协议进行通信的过程中，<code>http</code> 协议定义了基本认证认证允许 <code>http</code> 服务器对客户端进行用户身份证的方法。</p> <p>认证过程：</p> <p>1． 客户端向服务器请求数据，请求的内容可能是一个网页或者是一个<code>ajax</code>异步请求，此时，假设客户端尚未被验证，则客户端提供如下请求至服务器:</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>Get /index.html HTTP/1.0
<span class="token header-name keyword">Host:</span>www.google.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2． 服务器向客户端发送验证请求代码 401,（WWW-Authenticate: Basic realm=”google.com”这句话是关键，如果没有客户端不会弹出用户名和密码输入界面）服务器返回的数据大抵如下：</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.0</span> <span class="token status-code number">401</span> <span class="token reason-phrase string">Unauthorised</span></span>
<span class="token header-name keyword">Server:</span> SokEvo/1.0
<span class="token header-name keyword">WWW-Authenticate:</span> Basic realm=”google.com”
<span class="token header-name keyword">Content-Type:</span> text/html
<span class="token header-name keyword">Content-Length:</span> xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>3． 当符合 <code>http1.0</code> 或 <code>1.1</code> 规范的客户端（如 IE，FIREFOX）收到 401 返回值时，将自动弹出一个登录窗口，要求用户输入用户名和密码。</p> <p>4． 用户输入用户名和密码后，将用户名及密码以 <code>base64</code> 加密方式加密，并将密文放入前一条请求信息中，则客户端发送的第一条请求信息则变成如下内容：</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>Get /index.html HTTP/1.0
<span class="token header-name keyword">Host:</span>www.google.com
<span class="token header-name keyword">Authorization:</span> Basic d2FuZzp3YW5n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注：d2FuZzp3YW5n 表示加密后的用户名及密码（用户名：密码 然后通过 <code>base64</code> 加密，加密过程是浏览器默认的行为，不需要我们人为加密，我们只需要输入用户名密码即可）</p> <p>5． 服务器收到上述请求信息后，将 <code>Authorization</code> 字段后的用户信息取出、解密，将解密后的用户名及密码与用户数据库进行比较验证，如用户名及密码正确，服务器则根据请求，将所请求资源发送给客户端。</p> <p>效果：
客户端未未认证的时候，会弹出用户名密码输入框，这个时候请求时属于 pending 状态，这个时候其实服务当用户输入用户名密码的时候客户端会再次发送带 <code>Authentication</code> 头的请求。</p> <p>这个是出现较早的认证方式，实际使用中较少用到。仅做了解即可。</p> <h3 id="sesion-cookie"><a href="#sesion-cookie" class="header-anchor">#</a> Sesion-Cookie</h3> <p><code>HTTP Cookie</code> 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。 <code>Cookie</code> 使基于无状态的 <code>HTTP协议</code> 记录稳定的状态信息成为了可能。</p> <p><code>Cookie</code> 主要用于以下三个方面：</p> <ol><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li> <li>认证过程</li></ol> <p>服务器在接受客户端首次访问时在服务器端创建 <code>seesion</code> ，然后保存 <code>seesion</code> (我们可以将 <code>seesion</code> 保存在内存中，也可以保存在 <code>redis</code> 中，推荐使用后者)，然后给这个 <code>Sesion</code> 生成一个唯一的标识字符串,然后在响应头中种下这个唯一标识字符串。</p> <p>签名。这一步只是对 <code>Sesion_ID</code> 进行加密处理，服务端会根据这个 <code>secret</code> 密钥进行解密。（非必需步骤）</p> <p>浏览器中收到请求响应的时候会解析响应头，然后将 <code>Sesion_ID</code> 保存在本地 <code>Cookie</code> 中，浏览器在下次 <code>http</code> 请求的请求头中会带上该域名下的 <code>Cookie</code> 信息。</p> <p>服务器在接受客户端请求时会去解析请求头 <code>Cookie</code> 中的 <code>Sesion_ID</code> ，然后根据这个 <code>Sesion_ID</code> 去找服务器端保存的该客户端的 <code>Sesion</code> ，然后判断该请求是否合法。</p> <p>一旦用户登出，服务端和客户端同时销毁该会话在后续请求中，服务器会根据数据库验证会话 <code>id</code> ，如果验证通过，则继续处理；</p> <h4 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h4> <p>优点:</p> <ol><li>安全性高: 信息存储在服务器, 不易篡改。</li> <li>可以存储较大信息: <code>Cookie</code> 本身仅支持 4Kb 以下, 而 <code>Sesion</code> 存储于服务器, 依靠于数据库, 容量不限。</li> <li>存储类型多样: <code>Cookie</code> 只允许字符串类型, 而 <code>Sesion</code> 允许任意类型。</li> <li>可控性高: <code>Cookie</code> 本身只能设置固定有效时间, 而 <code>Sesion</code> 存储于服务器, 可以适应多种场景, 有效进行管理。
<ol><li>删除非法 <code>Sesion</code></li> <li>过期自动清理 <code>Sesion</code></li> <li>刷新有效时间</li></ol></li></ol> <p>缺点:</p> <ol><li>服务器存在负担: 随着用户量的增大, 每个用户都存储交互信息在服务器, 势必造成服务器负担。</li> <li><code>Sesion</code> 依靠 HTTPS 安全访问: 在不安全的网络环境下, <code>Cookie</code> 会被盗用, 意味着 <code>Sesion_ID</code> 会被盗用</li> <li><code>Sesion_ID</code> 盗用风险: 正如上一点所说, 其实 <code>Sesion_ID</code> 就是早期的 <code>Token</code> , 一旦被盗用就会导致非法用户盗用 <code>Sesion</code> 。</li> <li>不可跨域: 这是由于 <code>Cookie</code> 不可跨域导致, 不同域名需要不同验证</li> <li>不可共享: 在多集群服务器的情况下, A 服务器和 B 服务器 <code>Sesion</code> 不共享, 需要而外进行配置</li> <li>CSRS 攻击: 如果网站存在恶意脚本比如 <a href="http://www.bank.com/api/transfer?count=1000&amp;to=Tom" target="_blank" rel="noopener noreferrer">http://www.bank.com/api/transfer?count=1000&amp;to=Tom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 这种脚本存储在一段文本甚至是一张图片中, 如果我们使用 <code>Sesion</code> 的方式, 当我们点击图片就会导致触发。</li></ol> <h3 id="token-验证"><a href="#token-验证" class="header-anchor">#</a> Token 验证</h3> <p>认证过程：</p> <ol><li>用户输入登陆凭据；</li> <li>服务器验证凭据是否正确，然后返回一个经过签名的 <code>Token</code> ；</li> <li>客户端负责存储 <code>Token</code> ，可以存在 <code>localstorage</code> ，或者 <code>Cookie</code> 中</li> <li>对服务器的请求带上这个 <code>Token</code> ；</li> <li>服务器对 <code>JWT</code> 进行解码，如果 <code>Token</code> 有效，则处理该请求；</li> <li>一旦用户登出，客户端销毁 <code>Token</code> 。</li></ol> <p><code>Cookie-Sesion</code> 与 <code>taken</code> 看上去很像，那么他们到底有什么区别呢？</p> <p>从标识的所携带的信息来看：
<code>Cookie-Sesion</code> 中的 <code>Sesion_ID</code>他只是一个唯一标识的字符串，服务端是根据这个字符串，来查询在服务器端保持的 <code>seesion</code> ，这里面才保存着用户的登陆状态。</p> <p>但是 <code>Token</code> 本身就是一种登陆成功凭证，他是在登陆成功后根据某种规则生成的一种信息凭证，他里面本身就保存着用户的登陆状态。服务器端只需要根据定义的规则校验这个 <code>Token</code> 是否合法就行。</p> <p>从使用方式来看：
<code>Cookie-Sesion</code> 是需要 <code>Cookie</code> 配合的，那么在 <code>http</code> 代理客户端的选择上就是只有浏览器了，因为只有浏览器才会去解析请求响应头里面的 <code>Cookie</code> ,然后每次请求再默认带上该域名下的 <code>Cookie</code> 。但是我们知道 <code>http</code> 代理客户端不只有浏览器，还有原生 APP 等等，这个时候 <code>Cookie</code> 是不起作用的，或者浏览器端是可以禁止<code>Cookie</code> 的。</p> <p>但是 <code>Token</code> 就不一样，他是登陆请求在登陆成功后再请求响应体中返回的信息，客户端在收到响应的时候，可以把他存在本地的 <code>Cookie</code> , <code>storage</code>，或者内存中，然后再下一次请求的请求头重带上这个 <code>Token</code> 就行了。(通常是放置到 <code>http</code> 请求头里的 <code>Authorization</code> 上)
简单点来说<code>Cookie-Sesion</code>机制他限制了客户端的类型，而<code>Token</code>验证机制丰富了客户端类型。</p> <p>从时效性来看：
<code>Sesion-Cookie</code>的<code>Sesionid</code>实在登陆的时候生成的而且在登出事时一直不变的，在一定程度上安全就会低，而<code>Token</code>是可以在一段时间内动态改变的。
可扩展性。<code>Token</code>验证本身是比较灵活的，一是<code>Token</code>的解决方案有许多，常用的是<code>JWT</code>，二来我们可以基于<code>Token</code>验证机制，专门做一个鉴权服务，用它向多个服务的请求进行统一鉴权。</p> <h4 id="优缺点-2"><a href="#优缺点-2" class="header-anchor">#</a> 优缺点</h4> <p>优点：</p> <ol><li><code>Token</code> 可以防范, 或者说是专门防范 <code>CSRF</code> 攻击, 不会被自动加入请求头。</li> <li><code>Token</code> 存储在报文头的 <code>Authorization</code> 字段中。</li> <li><code>Token</code> 支持跨域, 可以与第三方共享, 具体原理后续会介绍。</li> <li><code>Token</code> 不依赖于 <code>Cookie</code> 在移动端中适配良好。</li> <li><code>Token</code> 存储在客户端(<code>localStorage</code>), 使服务器无状态化, 减少负担。</li></ol> <p>缺点:</p> <ol><li><code>Token</code> 不能管理自己发出的令牌, 如果令牌被盗用, 服务端也难以进行注销。对此 <code>Sesion</code> 的优势就很明显, 可以很好的管控自己的会话。</li></ol> <h3 id="oauth-2-0-开放授权"><a href="#oauth-2-0-开放授权" class="header-anchor">#</a> OAuth 2.0(开放授权)</h3> <p>OAuth 2.0 是一个业界标准的授权协议，其定义了四种可以适用于各种应用场景的授权交互模式：授权码模式、应用授信模式、用户授信模式、简化模式。其中，授权码模式被广泛应用于第三方互联网开放平台，通过第三方登录是其最常见应用场景之一，比如使用微信、QQ 和淘宝账号进行登录。</p> <p>详见：<a href="https://zhuanlan.zhihu.com/p/92051359" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/92051359<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h2> <p>结合 XXX 项目来谈谈实际项目中是如何做项目鉴权的。</p> <p>XX 的前端架构是 FE ==&gt; BFF ==&gt; GO。</p> <p>由于这种特殊的架构，通常是将鉴权放置到 BFF 项目中进行的。</p> <p>任何一个 <code>FE</code> 的 <code>HTTP</code> 请求都会先走到 <code>BFF</code>(Koa 2) 的路由拦截器中，对于每一个请求，我们都需要从请求中的请求头拿到 <code>Authorization</code> 字段，然后将字段进行验证，判断是否有效(通过 <code>GO</code> 提供的接口进行验证)，如果有效，则放行。如果 <code>Token</code> 已经过期，用 <code>refresh_Token</code> 进行 <code>Token</code> 的续期，拿到新的 <code>Token</code> 再进行验证，验证通过放行，如果 <code>refresh_Token</code> 也无效，返回 <code>401</code> 状态码给 <code>FE</code> , <code>FE</code> 跳转到登录页。</p> <p>结合图示说明如下：</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2suf3hdyhj21010u0ab9.jpg" alt="XXX认证流程"></p> <p>此时，我们采用的方案是 <code>GO</code> 颁发 <code>Token</code> 认证信息(采用的是 JWT 授权方式)， <code>BFF</code> 进行权限的校验。</p> <p>对于 在 <code>Koa2</code> 中自行实现, <code>Sesion-coookie</code> 和 <code>Token</code> 验证方式的授权也很简单， <code>Koa2</code> 有对应的 中间件可直接使用，分别是: <a href="https://www.npmjs.com/package/Koa-Sesion" target="_blank" rel="noopener noreferrer">Koa-Sesion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://www.npmjs.com/package/Koa-jwt" target="_blank" rel="noopener noreferrer">Koa-jwt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">6/2/2022, 6:45:09 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-press-docs/pages/browser/storage.html" class="prev">
        前端存储技术
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-press-docs/assets/js/app.d8725ef0.js" defer></script><script src="/vue-press-docs/assets/js/2.a05206b7.js" defer></script><script src="/vue-press-docs/assets/js/13.c5264567.js" defer></script>
  </body>
</html>
