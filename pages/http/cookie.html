<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cookie的原理 | 不断进步</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vue-press-docs/不断进步.JPG">
    <meta name="description" content="Hit的前端笔记">
    
    <link rel="preload" href="/vue-press-docs/assets/css/0.styles.8e0a4dbf.css" as="style"><link rel="preload" href="/vue-press-docs/assets/js/app.d8725ef0.js" as="script"><link rel="preload" href="/vue-press-docs/assets/js/2.a05206b7.js" as="script"><link rel="preload" href="/vue-press-docs/assets/js/29.6b6978f8.js" as="script"><link rel="prefetch" href="/vue-press-docs/assets/js/10.291c5b1d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/11.837906d7.js"><link rel="prefetch" href="/vue-press-docs/assets/js/12.68839ecd.js"><link rel="prefetch" href="/vue-press-docs/assets/js/13.c5264567.js"><link rel="prefetch" href="/vue-press-docs/assets/js/14.29739af6.js"><link rel="prefetch" href="/vue-press-docs/assets/js/15.e3c8b020.js"><link rel="prefetch" href="/vue-press-docs/assets/js/16.218006ef.js"><link rel="prefetch" href="/vue-press-docs/assets/js/17.e118f6a2.js"><link rel="prefetch" href="/vue-press-docs/assets/js/18.a6aa10bb.js"><link rel="prefetch" href="/vue-press-docs/assets/js/19.8a65c4ea.js"><link rel="prefetch" href="/vue-press-docs/assets/js/20.2a59e164.js"><link rel="prefetch" href="/vue-press-docs/assets/js/21.f3d67e95.js"><link rel="prefetch" href="/vue-press-docs/assets/js/22.0f5ad16d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/23.21d9d0f1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/24.3d484fb5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/25.c603a96a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/26.9ab9b754.js"><link rel="prefetch" href="/vue-press-docs/assets/js/27.38a22fef.js"><link rel="prefetch" href="/vue-press-docs/assets/js/28.a6fb0ad4.js"><link rel="prefetch" href="/vue-press-docs/assets/js/3.a38e7322.js"><link rel="prefetch" href="/vue-press-docs/assets/js/30.9105745c.js"><link rel="prefetch" href="/vue-press-docs/assets/js/31.646dcbc3.js"><link rel="prefetch" href="/vue-press-docs/assets/js/32.6fb88f54.js"><link rel="prefetch" href="/vue-press-docs/assets/js/33.efb42491.js"><link rel="prefetch" href="/vue-press-docs/assets/js/34.53339129.js"><link rel="prefetch" href="/vue-press-docs/assets/js/35.368c2a62.js"><link rel="prefetch" href="/vue-press-docs/assets/js/36.593a1558.js"><link rel="prefetch" href="/vue-press-docs/assets/js/37.03b7eb3f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/38.119c7171.js"><link rel="prefetch" href="/vue-press-docs/assets/js/39.f3303696.js"><link rel="prefetch" href="/vue-press-docs/assets/js/4.0911b1c1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/40.a727a31c.js"><link rel="prefetch" href="/vue-press-docs/assets/js/41.df01778a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/42.24907559.js"><link rel="prefetch" href="/vue-press-docs/assets/js/43.f7efdd24.js"><link rel="prefetch" href="/vue-press-docs/assets/js/44.ed8a586a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/45.4153c8f6.js"><link rel="prefetch" href="/vue-press-docs/assets/js/46.38ee2887.js"><link rel="prefetch" href="/vue-press-docs/assets/js/47.fafe4e22.js"><link rel="prefetch" href="/vue-press-docs/assets/js/48.11cf3a32.js"><link rel="prefetch" href="/vue-press-docs/assets/js/49.9b4b506b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/5.30bb248a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/50.90535ee5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/51.59a46172.js"><link rel="prefetch" href="/vue-press-docs/assets/js/52.34a795d5.js"><link rel="prefetch" href="/vue-press-docs/assets/js/53.b82f43b1.js"><link rel="prefetch" href="/vue-press-docs/assets/js/54.9a76148f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/55.75ac5779.js"><link rel="prefetch" href="/vue-press-docs/assets/js/56.afdafb93.js"><link rel="prefetch" href="/vue-press-docs/assets/js/57.769f07f9.js"><link rel="prefetch" href="/vue-press-docs/assets/js/58.91bd0e5b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/59.9b1b7a2b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/6.262368dc.js"><link rel="prefetch" href="/vue-press-docs/assets/js/60.79f7ba50.js"><link rel="prefetch" href="/vue-press-docs/assets/js/61.e2b3466d.js"><link rel="prefetch" href="/vue-press-docs/assets/js/62.25ae7055.js"><link rel="prefetch" href="/vue-press-docs/assets/js/63.1c398391.js"><link rel="prefetch" href="/vue-press-docs/assets/js/64.8fa35e00.js"><link rel="prefetch" href="/vue-press-docs/assets/js/65.6c8bf068.js"><link rel="prefetch" href="/vue-press-docs/assets/js/66.44daef8f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/67.66f09b37.js"><link rel="prefetch" href="/vue-press-docs/assets/js/68.6ffa134a.js"><link rel="prefetch" href="/vue-press-docs/assets/js/69.d547c1ee.js"><link rel="prefetch" href="/vue-press-docs/assets/js/7.fd046e46.js"><link rel="prefetch" href="/vue-press-docs/assets/js/70.c933e292.js"><link rel="prefetch" href="/vue-press-docs/assets/js/71.4170c744.js"><link rel="prefetch" href="/vue-press-docs/assets/js/72.759f4574.js"><link rel="prefetch" href="/vue-press-docs/assets/js/73.60ef846f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/74.bcd5ecfd.js"><link rel="prefetch" href="/vue-press-docs/assets/js/75.20843078.js"><link rel="prefetch" href="/vue-press-docs/assets/js/76.fc952e66.js"><link rel="prefetch" href="/vue-press-docs/assets/js/77.7dd7f97f.js"><link rel="prefetch" href="/vue-press-docs/assets/js/78.2650c24b.js"><link rel="prefetch" href="/vue-press-docs/assets/js/79.b8caa6ba.js"><link rel="prefetch" href="/vue-press-docs/assets/js/8.a8d31d14.js"><link rel="prefetch" href="/vue-press-docs/assets/js/80.4a4a3d20.js"><link rel="prefetch" href="/vue-press-docs/assets/js/81.86cec7de.js"><link rel="prefetch" href="/vue-press-docs/assets/js/9.179dc13a.js">
    <link rel="stylesheet" href="/vue-press-docs/assets/css/0.styles.8e0a4dbf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-press-docs/" class="home-link router-link-active"><img src="/vue-press-docs/hit.JPG" alt="不断进步" class="logo"> <span class="site-name can-hide">不断进步</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-press-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/html/html.html" class="nav-link">
  html系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/css/css.html" class="nav-link">
  css系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/javaScript/Object.freeze()和const.html" class="nav-link">
  javaScript系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/typeScript/base.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/http/http.html" class="nav-link">
  http系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/project/guide.html" class="nav-link">
  前端工程化系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/node/node.html" class="nav-link">
  node系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/browser/browser.html" class="nav-link">
  浏览器系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework/nextTick.html" class="nav-link">
  框架使用系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework-source/vue-source.html" class="nav-link">
  框架源码系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/optimization/vue-code.html" class="nav-link">
  性能优化系列
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Huhui-coder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-press-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/html/html.html" class="nav-link">
  html系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/css/css.html" class="nav-link">
  css系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/javaScript/Object.freeze()和const.html" class="nav-link">
  javaScript系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/typeScript/base.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/http/http.html" class="nav-link">
  http系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/project/guide.html" class="nav-link">
  前端工程化系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/node/node.html" class="nav-link">
  node系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/browser/browser.html" class="nav-link">
  浏览器系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework/nextTick.html" class="nav-link">
  框架使用系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/framework-source/vue-source.html" class="nav-link">
  框架源码系列
</a></li><li class="dropdown-item"><!----> <a href="/vue-press-docs/pages/optimization/vue-code.html" class="nav-link">
  性能优化系列
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Huhui-coder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>cookie</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-press-docs/pages/http/cookie.html" aria-current="page" class="active sidebar-link">cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#cookie的原理" class="sidebar-link">cookie的原理</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#cookie的常见属性" class="sidebar-link">cookie的常见属性</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#服务端操作cookie示例-express-web框架" class="sidebar-link">服务端操作cookie示例：(express WEB框架)</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#客户端操作cookie示例-js" class="sidebar-link">客户端操作cookie示例（js）：</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#实际案例-单点登录" class="sidebar-link">实际案例：单点登录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#单系统登录" class="sidebar-link">单系统登录</a></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#多系统登录" class="sidebar-link">多系统登录</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue-press-docs/pages/http/cookie.html#实际案例-保存客户端与服务端会话状态" class="sidebar-link">实际案例：保存客户端与服务端会话状态</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="cookie的原理"><a href="#cookie的原理" class="header-anchor">#</a> cookie的原理</h2> <p><img src="https://i.loli.net/2020/01/22/Qlk4drjyuTCvwcg.png" alt="image.png"></p> <ol><li>客户端发送 HTTP 请求到服务器</li> <li>当服务器收到 HTTP 请求时，在响应头里面添加一个 Set-Cookie 字段</li> <li>浏览器收到响应后保存下 Cookie</li> <li>之后对该服务器每一次请求中都通过 Cookie 字段将 Cookie 信息发送给服务器。</li></ol> <h2 id="cookie的常见属性"><a href="#cookie的常见属性" class="header-anchor">#</a> cookie的常见属性</h2> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>name<span class="token punctuation">:</span>代表cookie的名字的意思，一个域名下绑定的cookie，name不能相同，相同的name的值会被覆盖掉<span class="token punctuation">.</span>
value<span class="token punctuation">:</span>代表cookie的值。
domain<span class="token punctuation">:</span>代表的是，cookie绑定的域名，如果没有设置，就会自动绑定到执行语句的当前域，还有值得注意的点，统一个域名下的二级域名也是不可以交换使用cookie的，比如，你设置www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com和image<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">,</span>依旧是不能公用的
path：指定 cookie 影响到的路径
expires<span class="token punctuation">:</span> 现在已经被max<span class="token operator">-</span>age属性所取代，max<span class="token operator">-</span>age用秒来设置cookie的生存期。
maxAge：指定 cookie 什么时候过期
secure：当 secure 值为 <span class="token boolean">true</span> 时，在 HTTPS 中才有效；反之，cookie 在 HTTP 中是有效。
httpOnly：浏览器不允许脚本操作 document<span class="token punctuation">.</span>cookie 去更改 cookie。设置为<span class="token boolean">true</span>可以避免被 xss 攻击拿到 cookie
<span class="token class-name">SameSite</span><span class="token punctuation">:</span> <span class="token class-name">SameSite</span> 属性可以让 <span class="token class-name">Cookie</span> 在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意： <code>expires</code>和<code>maxAge</code></p> <p><code>expires</code>当 expires 属性缺省时，表示是会话性 Cookie， Expires 的值为 Session，表示的就是会话性 Cookie。当为会话性 Cookie 的时候，值保存在客户端内存中，并在用户关闭浏览器时失效。需要注意的是，有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期 Cookie 也会被保留下来，就好像浏览器从来没有关闭一样。</p> <p>与会话性 Cookie 相对的是持久性 Cookie，持久性 Cookies 会保存在用户的硬盘中，直至过期或者清除 Cookie。这里值得注意的是，设定的日期和时间只与客户端相关，而不是服务端。</p> <p><code>maxAge</code>用于设置在 Cookie 失效之前需要经过的秒数。比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Set-Cookie: id=a3fWa; Max-Age=604800;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>max-age 可以为正数、负数、甚至是 0。</p> <p>如果 max-Age 属性为正数时，浏览器会将其持久化，即写到对应的 Cookie 文件中。</p> <p>当 max-Age 属性为负数，则表示该 Cookie 只是一个会话性 Cookie。</p> <p>当 max-Age 为 0 时，则会立即删除这个 Cookie。</p> <p><strong>假如 expires 和 max-age 都存在，max-age 优先级更高。</strong></p> <p>注意：<code>domain</code>和<code>path</code></p> <p>dmain 指定了 Cookie 可以送达的主机名。假如没有指定，那么默认值为当前文档访问地址中的主机部分（但是不包含子域名）。</p> <p>像淘宝首页设置的 Domain 就是 .taobao.com，这样无论是 a.taobao.com 还是 b.taobao.com 都可以使用 Cookie。</p> <p>在这里注意的是，不能跨域设置 Cookie，比如阿里域名下的页面把 Domain 设置成百度是无效的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Set-Cookie: qwerty=219ffwef9w0f; Domain=baidu.com; Path=/; Expires=Wed, 30 Aug 2020 00:00:00 GMT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>path 指定了一个 URL 路径，这个路径必须出现在要请求的资源的路径中才可以发送 Cookie 首部。比如设置 <code>Path=/docs</code>，<code>/docs/Web/</code> 下的资源会带 Cookie 首部，<code>/test</code> 则不会携带 Cookie 首部。</p> <p>Domain 和 Path 标识共同定义了 Cookie 的作用域：即 Cookie 应该发送给哪些 URL。</p> <p>如果直接设置<code>domain</code>为 主机部分地址，<code>path</code> 设置为'/'，那么该域名下的所有url都能接收到该cookie。</p> <p>注意：<code>http-only</code>和<code>secre</code></p> <p>http-only 无法被网页脚本读取，不限制传输通路的安全性（document.cookie）
secure 可以被网页脚本读取，只允许通过安全通路发送给服务器(只能通过https)</p> <p>注意： <code>SameSite</code></p> <ol><li><strong>Strict</strong> 仅允许一方请求携带 Cookie，即浏览器将只发送相同站点请求的 Cookie，即当前网页 URL 与请求目标 URL 完全一致。</li> <li><strong>Lax</strong> 允许部分第三方请求携带 Cookie。</li> <li><strong>None</strong> 无论是否跨站都会发送 Cookie。</li></ol> <p>新版本Chrome默认策略是把SameSite设置为Lax，为了避免网站受影响，许多人想到的最简单的方法就是设置SameSite属性为None。不过有些老版本浏览器并不识别值为None的情况，所以一般服务端需要这么设置：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Set-cookie: key=value; SameSite=None; Secure
Set-cookie: key=value; Secure
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>另外一点需要注意的是当设置SameSite=None时，必须同时设置Secure属性。表示只有在 HTTPS 协议下该 Cookie 才会被发送。</p> <h2 id="服务端操作cookie示例-express-web框架"><a href="#服务端操作cookie示例-express-web框架" class="header-anchor">#</a> 服务端操作cookie示例：(express WEB框架)</h2> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 处理cookie的中间件</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 cookieParser 中间件;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果请求中的 cookie 存在 isFirst</span>
<span class="token comment">// 否则，设置 cookie 字段 isFirst, 并设置过期时间为10秒</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>isFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;再次欢迎访问&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//格式为res.cookie('key',value,{options})</span>
        res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'isFirst'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;欢迎第一次访问&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3030</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express start on: '</span> <span class="token operator">+</span> <span class="token number">3030</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="客户端操作cookie示例-js"><a href="#客户端操作cookie示例-js" class="header-anchor">#</a> 客户端操作cookie示例（js）：</h2> <p>推荐使用js-cookie库</p> <p>cookie 的属性</p> <p><code>读取所有可从此位置访问的Cookie</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>allCookies = document.cookie;  //使用该方法可以获取到所有的cookie 键值对
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>cookie 是以key = value 这样的键值对形式存在的。</p> <p><code>写一个新cookie</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>document.cookie = newCookie;  // 使用该方法一次只能对一个cookie 进行生成和更新。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下可选的cookie属性值可以跟在键值对后，用来具体化对cookie的设定/更新，使用分号以作分隔。</p> <p>示例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;someCookieName=true; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="实际案例-单点登录"><a href="#实际案例-单点登录" class="header-anchor">#</a> <strong>实际案例：单点登录</strong></h2> <p>是目前比较流行的企业业务整合的解决方案之一，用于多个应用系统间，用户只需要登录一次就可以访问所有相互信任的应用系统。</p> <p>前置知识：(注意cookie默认是不支持跨域的)</p> <p>1.同源策略 限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互，要求协议，端口和主机都相同。</p> <p>2.HTTP 用于分布式、协作式和超媒体信息系统的应用层协议。HTTP 是无状态协议，所以服务器单从网络连接上无从知道客户身份。 那要如何才能识别客户端呢？给每个客户端颁发一个通行证，每次访问时都要求带上通行证，这样服务器就可以根据通行证识别客户了。最常见的方案就是 Cookie。</p> <p>3.Cookie 是客户端保存用户信息的一种机制，保存在客户机硬盘上。可以由服务器响应报文<code>Set-Cookie</code>的首部字段信息或者客户端 <code>document.cookie</code>来设置，并随着每次请求发送到服务器。子域名可以获取父级域名 Cookie。</p> <p>4.Session 其实是一个抽象概念，用于跟踪会话，识别多次 HTTP 请求来自同一个客户端。Cookie 只是通用性较好的一种实现方案，通常是设置一个名为 SessionID（名称可自定义，便于描述，本文均使用此名称）的 Cookie，每次请求时携带该 Cookie，后台服务即可依赖此 SessionID 值识别客户端。</p> <h3 id="单系统登录"><a href="#单系统登录" class="header-anchor">#</a> <strong>单系统登录</strong></h3> <p>直接使用JWT实现登录信息检验，在生成token的时候，可以将用户id添加进去，这样用户登录之后，每次的请求都带上这个token，那么每次请求都能识别用户。</p> <h3 id="多系统登录"><a href="#多系统登录" class="header-anchor">#</a> <strong>多系统登录</strong></h3> <p>在同域名cookie是共享的。</p> <p>不同子域名登录时，可以设置父级域名，由于每个子域名是跟父级域名cookie共享的，每次去改变或者获取父级域名。这样也能间接实现子域名cookie共享。</p> <p>完全不同域名，默认情况下，不同域名是无法直接共享 Cookie 的。</p> <p>前端跨域带 Cookie，如果只是期望异步请求时获取当前用户的登录态，可以通过发送跨域请求到已经登录过的域名，并配置属性：（需要前后端都配置）</p> <p>通过 前端配置ajax请求头'withCredentials'为true，以及后台配置('Access-Control-Allow-Origin','IP端口'）和('Access-Control-Allow-Credentials',true)，注意：Access-Control-Allow-Origin不能配置为‘*’；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 原生ajax
xhrFields: {
  withCredentials: true
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>// axios 
axios.defaults.withCredentials = true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="实际案例-保存客户端与服务端会话状态"><a href="#实际案例-保存客户端与服务端会话状态" class="header-anchor">#</a> 实际案例：保存客户端与服务端会话状态</h2> <p>因为http1.x 是无状态协议，单纯从http协议来说无法保存信息的。</p> <p>假设这么一个场景，我登录一个系统，登录之后，我需要获取access-token,和用户的一些信息。这个时候单纯通过http是不可行的，所以需要借助cookie来实现。</p> <ol><li>客户端发送 HTTP 请求到服务器</li> <li>当服务器收到 HTTP 请求时，在响应头里面添加一个 Set-Cookie 字段</li> <li>浏览器收到响应后保存下 Cookie</li> <li>之后对该服务器每一次请求中都通过 Cookie 字段将 Cookie 信息发送给服务器。</li></ol> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf6yzszudfj31iu0h2jwc.jpg" alt="image-20200527113514398"></p> <p>前端vue直接通过<code>js-cookie</code>npm 库就可以直接操作cookie了。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">5/27/2020, 3:10:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-press-docs/pages/http/http缓存.html" class="prev">
        http缓存
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-press-docs/assets/js/app.d8725ef0.js" defer></script><script src="/vue-press-docs/assets/js/2.a05206b7.js" defer></script><script src="/vue-press-docs/assets/js/29.6b6978f8.js" defer></script>
  </body>
</html>
